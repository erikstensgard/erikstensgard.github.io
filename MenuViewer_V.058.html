<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON Test</title>
  <style>
    /* Common styles */
    table {
      border-collapse: collapse;
      padding: 0; /* Reduce table padding */
    }

    th,
    td {
      border: none;
      padding: 4px; /* Reduce cell padding */
    }

    .clickable {
      color: blue;
      cursor: pointer;
    }

    .bold {
      font-weight: bold;
      background-color: lightblue; /* Set your desired background color here */
    }

    /* Header styles */
    #header {
      position: sticky;
      top: 0;
      background-color: white;
      z-index: 1;
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }

    #header button,
    #header select {
      margin: 5px;
      flex: 0 0 auto;
    }

    #goBackButton {
      margin-left: 20px;
    }

    #mainMenuButton {
      margin-right: auto;
    }

    #goForwardButton {
      margin-right: 20px;
    }

    #filterDropdown {
      margin-right: 20px;
    }

    /* Table styles */
    .table {
      table-layout: fixed;
      width: 100%;
    }

    .table td {
      white-space: nowrap; /* Disable text wrapping within a cell */
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: var(--font-size); /* Set initial font size */
    }

    /* Media queries for responsive design */
    @media screen and (max-width: 768px) {
      /* Adjust table font size for smaller screens */
      .table td {
        font-size: 11px;
      }

      /* Adjust button and dropdown font size for smaller screens */
      button,
      select {
        font-size: 11px;
      }
    }

    @media screen and (max-width: 480px) {
      /* Further adjust table font size for even smaller screens */
      .table td {
        font-size: 8px;
      }

      /* Further adjust button and dropdown font size for even smaller screens */
      button,
      select {
        font-size: 8px;
      }
    }
  </style>
</head>

<body>
  <div id="header">
    <button id="goBackButton">&larr; Go Back</button>
    <button id="mainMenuButton">Main Menu</button>
    <button id="goForwardButton">Go Forward &rarr;</button>
    <select id="filterDropdown"></select>
  </div>

  <div id="resultContainer"></div>

  <div id="footer">
    <button id="downloadJSONButton">Download JSON</button>
  </div>

  <script>
    // Fetch OMJSON Data
    async function fetchOMData() {
      const response = await fetch('MinneapolisOMJSON.json');
      const data = await response.json();
      return data;
    }

    // Fetch ODJSON Data
    async function fetchODData() {
      const response = await fetch('MinneapolisODJSON.json');
      const data = await response.json();
      return data;
    }

    // Merge ODJSON Data with OMJSON Data
    function mergeData(omData, odData) {
      const mergedData = [];
      for (let i = 0; i < odData.length; i++) {
        const odRow = odData[i];
        const omRow = omData.find((row) => row.ORIGID === odRow.ORIGID && row.DESTID === odRow.DESTID);
        if (omRow) {
          mergedData.push({ ...omRow, ...odRow });
        }
      }
      return mergedData;
    }

    // Create HTML table from data
    function createTable(data) {
      const table = document.createElement('table');
      table.classList.add('table');

      // Create table header
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      for (const key in data[0]) {
        const th = document.createElement('th');
        th.textContent = key;
        headerRow.appendChild(th);
      }
      thead.appendChild(headerRow);
      table.appendChild(thead);

      // Create table body
      const tbody = document.createElement('tbody');
      for (const row of data) {
        const dataRow = document.createElement('tr');
        for (const key in row) {
          const td = document.createElement('td');
          td.textContent = row[key];
          dataRow.appendChild(td);
        }
        tbody.appendChild(dataRow);
      }
      table.appendChild(tbody);

      return table;
    }

    // Clear previous table and display new table
    function displayTable(data) {
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.innerHTML = '';
      resultContainer.appendChild(createTable(data));
    }

    // Set font size based on screen size and column count
    function setFontSize() {
      const table = document.querySelector('.table');
      const cell = table.querySelector('td');
      const cellWidth = cell.offsetWidth;
      const columnCount = table.querySelector('tr').childElementCount;
      const fontSize = Math.floor(cellWidth / 10) + (2 - columnCount) + 'px';
      table.style.setProperty('--font-size', fontSize);
    }

    // Fetch and merge data, then display table
    async function fetchDataAndDisplayTable() {
      const omData = await fetchOMData();
      const odData = await fetchODData();
      const mergedData = mergeData(omData, odData);
      displayTable(mergedData);
      setFontSize();
    }

    // Event listeners
    window.addEventListener('resize', setFontSize);

    // Fetch data and display table on page load
    fetchDataAndDisplayTable();
  </script>
</body>

</html>

