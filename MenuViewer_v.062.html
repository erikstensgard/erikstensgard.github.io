<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON Test</title>
  <style>
    /* Common styles */
    table {
      border-collapse: collapse;
      padding: 0; /* Reduce table padding */
    }

    th,
    td {
      border: none;
      padding: 4px; /* Reduce cell padding */
    }

    .clickable {
      color: blue;
      cursor: pointer;
    }

    .bold {
      font-weight: bold;
      background-color: lightblue; /* Set your desired background color here */
    }

    /* Header styles */
    #header {
      position: sticky;
      top: 0;
      background-color: white;
      z-index: 1;
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }

    #header button,
    #header select {
      margin: 5px;
      flex: 0 0 auto;
    }

    #goBackButton {
      margin-left: 20px;
    }

    #mainMenuButton {
      margin-right: auto;
    }

    #goForwardButton {
      margin-right: 20px;
    }

    #filterDropdown {
      margin-right: 20px;
    }


    /* Table styles */
    .table {
      table-layout: fixed;
      width: 100%;
    }

    .table td {
      white-space: nowrap; /* Disable text wrapping within a cell */
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Media queries for responsive design */
    @media screen and (max-width: 768px) {
      /* Adjust button and dropdown font size for smaller screens */
      button,
      select {
        font-size: 11px;
      }
    }

    @media screen and (max-width: 480px) {
      /* Further adjust button and dropdown font size for even smaller screens */
      button,
      select {
        font-size: 8px;
      }
    }
  </style>

</head>

<body>
  <div id="header">
    <button id="goBackButton">&larr; Go Back</button>
    <button id="mainMenuButton">Main Menu</button>
    <button id="goForwardButton">Go Forward &rarr;</button>
    <select id="filterDropdown"></select>
  </div>

  <div id="resultContainer"></div>

  <div id="footer">
    <button id="downloadJSONButton">Download JSON</button>
  </div>

  <script>
    // Fetch OMJSON Data
    async function fetchOMData() {
      const response = await fetch('MinneapolisOMJSON.json');
      const data = await response.json();
      return data;
    }

    // Fetch ODJSON Data
    async function fetchODData() {
      const response = await fetch('MinneapolisODJSON.json');
      const data = await response.json();
      return data;
    }

    // Function to create HTML table from JSON data
    function createTable(data) {
      const table = document.createElement('table');
      table.classList.add('table');

      // Create table header
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      for (const key of Object.keys(data[0])) {
        const th = document.createElement('th');
        th.textContent = key;
        headerRow.appendChild(th);
      }
      thead.appendChild(headerRow);
      table.appendChild(thead);

      // Create table body
      const tbody = document.createElement('tbody');
      for (const obj of data) {
        const row = document.createElement('tr');
        for (const value of Object.values(obj)) {
          const td = document.createElement('td');
          td.textContent = value;
          row.appendChild(td);
        }
        tbody.appendChild(row);
      }
      table.appendChild(tbody);

      return table;
    }

    // Function to filter JSON data based on selected option
    function filterData(option, data) {
      if (option === 'All') {
        return data;
      }
      return data.filter(obj => obj.category === option);
    }

    // Function to update the table with filtered data
    function updateTable(option, data) {
      const filteredData = filterData(option, data);
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.innerHTML = '';

      if (filteredData.length === 0) {
        resultContainer.textContent = 'No results found.';
      } else {
        const table = createTable(filteredData);
        resultContainer.appendChild(table);
      }
    }

    // Function to populate the filter dropdown
    function populateFilterDropdown(data) {
      const filterDropdown = document.getElementById('filterDropdown');
      const options = Array.from(new Set(data.map(obj => obj.category)));

      const allOption = document.createElement('option');
      allOption.value = 'All';
      allOption.textContent = 'All';
      filterDropdown.appendChild(allOption);

      for (const option of options) {
        const opt = document.createElement('option');
        opt.value = option;
        opt.textContent = option;
        filterDropdown.appendChild(opt);
      }

      filterDropdown.addEventListener('change', function () {
        const selectedOption = this.value;
        updateTable(selectedOption, data);
      });
    }

    // Function to handle navigation buttons
    function handleNavigationButtons() {
      const goBackButton = document.getElementById('goBackButton');
      const goForwardButton = document.getElementById('goForwardButton');
      const backButtonHistory = [];
      const forwardButtonHistory = [];

      goBackButton.addEventListener('click', function () {
        if (backButtonHistory.length > 0) {
          const previousData = backButtonHistory.pop();
          forwardButtonHistory.push(currentData);
          updateTable('All', previousData);
        }
      });

      goForwardButton.addEventListener('click', function () {
        if (forwardButtonHistory.length > 0) {
          const nextData = forwardButtonHistory.pop();
          backButtonHistory.push(currentData);
          updateTable('All', nextData);
        }
      });
    }

    // Function to download JSON file
    function downloadJSONFile(data) {
      const jsonData = JSON.stringify(data);
      const blob = new Blob([jsonData], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'data.json';
      link.click();
      URL.revokeObjectURL(url);
    }

    // Function to handle download button click
    function handleDownloadButton(data) {
      const downloadButton = document.getElementById('downloadJSONButton');
      downloadButton.addEventListener('click', function () {
        downloadJSONFile(data);
      });
    }

    // Function to initialize the application
    async function initialize() {
      const omData = await fetchOMData();
      const odData = await fetchODData();
      const mergedData = mergeData(omData, odData);
      const defaultOption = 'All';

      populateFilterDropdown(mergedData);
      updateTable(defaultOption, mergedData);
      handleNavigationButtons();
      handleDownloadButton(mergedData);
    }

    // Helper function to merge OMJSON and ODJSON data
    function mergeData(omData, odData) {
      return omData.map((omObj, index) => {
        const odObj = odData[index];
        return { ...omObj, ...odObj };
      });
    }

    // Run the initialization function when the DOM is ready
    document.addEventListener('DOMContentLoaded', initialize);
  </script>
</body>

</html>
