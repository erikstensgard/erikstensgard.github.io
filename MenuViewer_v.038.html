<!DOCTYPE html>
<html>
<head>
  <style>
    /* Styles for the table */
    .table {
      border-collapse: collapse;
      width: 100%;
    }

    .table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    .table .bold {
      font-weight: bold;
    }

    .table .clickable {
      cursor: pointer;
      text-decoration: underline;
      color: blue;
    }

    /* Styles for the result container */
    #resultContainer {
      max-height: 400px;
      overflow-y: auto;
    }

    /* Styles for the buttons */
    #buttonContainer {
      position: fixed;
      top: 0;
      left: 0;
      background-color: #f9f9f9;
      padding: 8px;
      z-index: 999;
    }

    #filterDropdown {
      margin-right: 16px;
    }
  </style>
</head>

<body>
  <div id="buttonContainer">
    <button id="goBackButton">Go Back</button>
    <button id="mainMenuButton">Main Menu</button>
    <select id="filterDropdown">
      <option value="ORZID2 GMENU ABX INPT MAIN">ORZID2 GMENU ABX INPT MAIN</option>
      <option value="ORZID2 GMENU ABX INPT MNU">ORZID2 GMENU ABX INPT MNU</option>
      <option value="ORZID2 GMENU ABX INPT PF2">ORZID2 GMENU ABX INPT PF2</option>
      <option value="ORZID2 GMENU ABX INPT PF3">ORZID2 GMENU ABX INPT PF3</option>
      <option value="ORZID2 GMENU ABX INPT PF4">ORZID2 GMENU ABX INPT PF4</option>
    </select>
  </div>

  <div id="resultContainer"></div>

  <script>
    let omData = [];
    let odData = [];
    let selectedData = null;
    let history = [];

    // Fetch OMJSON Data
    async function fetchOMData() {
      const response = await fetch('MinneapolisOMJSON.json');
      const data = await response.json();
      return data;
    }

    // Fetch ODJSON Data
    async function fetchODData() {
      const response = await fetch('MinneapolisODJSON.json');
      const data = await response.json();
      return data;
    }

    // Populate the dropdown with options
    function populateDropdown(data) {
      const dropdown = document.getElementById('filterDropdown');

      data.forEach(item => {
        const option = document.createElement('option');
        option.value = item.Name;
        option.textContent = item.DisplayText;
        dropdown.appendChild(option);
      });
    }

    // Handle row click event
    function handleRowClick(item) {
      if (item.Item) {
        const matchingData = omData.find(data => data.Name === item.Item);

        if (matchingData) {
          selectedData = matchingData;
          createOMTable(matchingData);
          pushHistory(matchingData.Name);
        } else {
          const odMatchingData = odData.find(data => data.Name === item.Item);

          if (odMatchingData) {
            selectedData = odMatchingData;
            createODTable(odMatchingData);
            pushHistory(odMatchingData.Item);
          }
        }
      }
    }

    // Scroll to the top of the table
    function scrollToTop() {
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.scrollTop = 0;
    }

    // Function to create the OM table
    function createOMTable(data) {
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.innerHTML = '';

      const table = document.createElement('table');
      table.classList.add('table');

      const headerRow = document.createElement('tr');
      const headerNameCell = document.createElement('td');
      headerNameCell.classList.add('bold');
      headerNameCell.textContent = 'Name';
      const headerDisplayTextCell = document.createElement('td');
      headerDisplayTextCell.classList.add('bold');
      headerDisplayTextCell.textContent = 'Display Text';

      headerRow.appendChild(headerNameCell);
      headerRow.appendChild(headerDisplayTextCell);
      table.appendChild(headerRow);

      const row = document.createElement('tr');
      const nameCell = document.createElement('td');
      nameCell.textContent = data.Name;
      const displayTextCell = document.createElement('td');
      displayTextCell.textContent = data.DisplayText;

      row.appendChild(nameCell);
      row.appendChild(displayTextCell);
      table.appendChild(row);

      resultContainer.appendChild(table);
    }

    // Function to create the OD table
    function createODTable(data) {
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.innerHTML = '';

      const table = document.createElement('table');
      table.classList.add('table');

      const headerRow = document.createElement('tr');
      const headerItemCell = document.createElement('td');
      headerItemCell.classList.add('bold');
      headerItemCell.textContent = 'Item';

      headerRow.appendChild(headerItemCell);
      table.appendChild(headerRow);

      data.Items.forEach(item => {
        const row = document.createElement('tr');
        const itemCell = document.createElement('td');
        itemCell.classList.add('clickable');
        itemCell.textContent = item;

        itemCell.addEventListener('click', () => handleRowClick(item));
        row.appendChild(itemCell);
        table.appendChild(row);
      });

      resultContainer.appendChild(table);
    }

    // Function to handle the filter dropdown change event
    function filterData() {
      const dropdown = document.getElementById('filterDropdown');
      const selectedOption = dropdown.options[dropdown.selectedIndex];
      const selectedValue = selectedOption.value;

      const matchingData = omData.find(item => item.Name === selectedValue);

      if (matchingData) {
        selectedData = matchingData;
        createOMTable(matchingData);
        pushHistory(matchingData.Name);
      } else {
        const odMatchingData = odData.find(item => item.Name === selectedValue);

        if (odMatchingData) {
          selectedData = odMatchingData;
          createODTable(odMatchingData);
          pushHistory(odMatchingData.Name);
        }
      }

      // Scroll to the top of the table
      scrollToTop();
    }

    // Function to handle the go back button click event
    function handleGoBack() {
      const previousSelection = history.pop();
      const resultContainer = document.getElementById('resultContainer');

      if (previousSelection) {
        const matchingData = omData.find(item => item.Name === previousSelection);

        if (matchingData) {
          selectedData = matchingData;
          createOMTable(matchingData);
        } else {
          const odMatchingData = odData.find(item => item.Name === previousSelection);

          if (odMatchingData) {
            selectedData = odMatchingData;
            createODTable(odMatchingData);
          }
        }
      } else {
        selectedData = null;
        resultContainer.innerHTML = '';
      }

      // Scroll to the top of the table
      scrollToTop();
    }

    // Function to handle the main menu button click event
    function handleMainMenu() {
      selectedData = null;
      const resultContainer = document.getElementById('resultContainer');
      resultContainer.innerHTML = '';

      // Scroll to the top of the table
      scrollToTop();
    }

    // Function to push selection to history
    function pushHistory(selection) {
      history.push(selection);
    }

    // Initialize the application
    async function initialize() {
      omData = await fetchOMData();
      odData = await fetchODData();
      populateDropdown(omData);

      // Set the default selection
      const defaultSelection = 'ORZID2 GMENU ABX INPT MAIN';
      const defaultMatchingData = omData.find(item => item.Name === defaultSelection);

      if (defaultMatchingData) {
        selectedData = defaultMatchingData;
        createOMTable(defaultMatchingData);
        pushHistory(defaultMatchingData.Name);
      } else {
        const defaultODMatchingData = odData.find(item => item.Name === defaultSelection);

        if (defaultODMatchingData) {
          selectedData = defaultODMatchingData;
          createODTable(defaultODMatchingData);
          pushHistory(defaultODMatchingData.Name);
        }
      }

      // Scroll to the top of the table
      scrollToTop();

      // Add event listeners
      const filterDropdown = document.getElementById('filterDropdown');
      filterDropdown.addEventListener('change', filterData);

      const goBackButton = document.getElementById('goBackButton');
      goBackButton.addEventListener('click', handleGoBack);

      const mainMenuButton = document.getElementById('mainMenuButton');
      mainMenuButton.addEventListener('click', handleMainMenu);
    }

    // Initialize the application
    initialize();
  </script>
</body>

</html>
