<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON Test</title>
  <style>
    /* Common styles */
    table {
      border-collapse: collapse;
      padding: 0; /* Reduce table padding */
    }

    th,
    td {
      border: none;
      padding: 4px; /* Reduce cell padding */
    }

    .clickable {
      color: blue;
      cursor: pointer;
    }

    .bold {
      font-weight: bold;
      background-color: lightblue; /* Set your desired background color here */
    }

    /* Header styles */
    #header {
      position: sticky;
      top: 0;
      background-color: white;
      z-index: 1;
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }

    #header button,
    #header select {
      margin: 5px;
      flex: 0 0 auto;
    }

    #goBackButton {
      margin-left: 20px;
    }

    #mainMenuButton {
      margin-right: auto;
    }

    #goForwardButton {
      margin-right: 20px;
    }

    #filterDropdown {
      margin-right: 20px;
    }

    /* Table styles */
    .table {
      table-layout: fixed;
      width: 100%;
    }

    .table td {
      white-space: nowrap; /* Disable text wrapping within a cell */
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Media queries for responsive design */
    @media screen and (max-width: 768px) {
      /* Adjust button and dropdown font size for smaller screens */
      button,
      select {
        font-size: 11px;
      }
    }

    @media screen and (max-width: 480px) {
      /* Further adjust button and dropdown font size for even smaller screens */
      button,
      select {
        font-size: 8px;
      }
    }
  </style>
</head>

<body>
  <div id="header">
    <button id="goBackButton">&larr; Go Back</button>
    <button id="mainMenuButton">Main Menu</button>
    <button id="goForwardButton">Go Forward &rarr;</button>
    <select id="versionDropdown"></select>
    <select id="filterDropdown"></select>
  </div>

  <div id="resultContainer"></div>

  <div id="footer">
    <button id="downloadJSONButton">Download JSON</button>
  </div>

  <script>
    // Global variables
    let versionData = []; // Version data
    let omData = []; // OMJSON data
    let odData = []; // ODJSON data
    let selectedData = null; // Currently selected data
    let history = []; // History of selected items
    let forwardHistory = []; // History of forward selections
    let historyIndex = -1; // Index of the current selection in the history

    // Fetch version data
    async function fetchVersionData() {
      const response = await fetch('versionData.json');
      const data = await response.json();
      return data;
    }

    // Fetch OMJSON Data for the selected version
    async function fetchOMData(version) {
      const response = await fetch(`${version}OMJSON.json`);
      const data = await response.json();
      return data;
    }

    // Fetch ODJSON Data for the selected version
    async function fetchODData(version) {
      const response = await fetch(`${version}ODJSON.json`);
      const data = await response.json();
      return data;
    }

    // Function to populate dropdown with version data
    function populateVersionDropdown() {
      const dropdown = document.getElementById('versionDropdown');
      dropdown.innerHTML = '';

      versionData.forEach(item => {
        const option = document.createElement('option');
        option.value = item;
        option.textContent = item;
        dropdown.appendChild(option);
      });
    }

    // Function to populate dropdown with OMJSON data based on the selected version
    function populateDropdown(data) {
      const dropdown = document.getElementById('filterDropdown');
      dropdown.innerHTML = '';

      data.sort((a, b) => {
        const displayTextA = a.DisplayText || a.Name;
        const displayTextB = b.DisplayText || b.Name;
        return displayTextA.localeCompare(displayTextB);
      });

      data.forEach(item => {
        const option = document.createElement('option');
        option.value = item.Name;
        option.textContent = item.DisplayText || item.Name;
        dropdown.appendChild(option);
      });
    }

    // Function to filter data based on the selected option and version
    function filterData(event) {
      const selectedOption = event.target.value;
      const selectedVersion = document.getElementById('versionDropdown').value;

      if (selectedVersion && selectedVersion !== '' && selectedOption && selectedOption !== '') {
        const matchingData = omData.find(item => item.Name === selectedOption);
        if (matchingData) {
          selectedData = matchingData;
          createOMTable(matchingData);
          pushHistory(matchingData.Name);
        } else {
          const odMatchingData = odData.find(item => item.Name === selectedOption);
          if (odMatchingData) {
            selectedData = odMatchingData;
            createODTable(odMatchingData);
            pushHistory(odMatchingData.Item);
          }
        }

        adjustFontSize();
        // Scroll to the top of the table
        const resultContainer = document.getElementById('resultContainer');
        resultContainer.scrollTop = 0;
      }
    }

    // Function to handle version change event
    function handleVersionChange(event) {
      const selectedVersion = event.target.value;

      if (selectedVersion && selectedVersion !== '') {
        const matchingVersionData = versionData.find(item => item === selectedVersion);
        if (matchingVersionData) {
          fetchOMData(selectedVersion)
            .then(data => {
              omData = data;
              populateDropdown(omData);
              filterData({ target: document.getElementById('filterDropdown') });
            })
            .catch(error => {
              console.error('Error:', error);
            });

          fetchODData(selectedVersion)
            .then(data => {
              odData = data;
              populateDropdown(odData);
              filterData({ target: document.getElementById('filterDropdown') });
            })
            .catch(error => {
              console.error('Error:', error);
            });
        }
      }
    }

    // Function to handle the click event of the "Go Back" button
    function handleGoBack() {
      if (historyIndex > 0) {
        historyIndex--;
        const selectedItem = history[historyIndex];
        const dropdown = document.getElementById('filterDropdown');
        dropdown.value = selectedItem;
        filterData({ target: dropdown });
      }
    }

    // Function to handle the click event of the "Go Forward" button
    function handleGoForward() {
      if (historyIndex < history.length - 1) {
        historyIndex++;
        const selectedItem = history[historyIndex];
        const dropdown = document.getElementById('filterDropdown');
        dropdown.value = selectedItem;
        filterData({ target: dropdown });
      }
    }

    // Function to handle the click event of the "Main Menu" button
    function handleMainMenu() {
      historyIndex = -1;
      history = [];
      forwardHistory = [];
      const dropdown = document.getElementById('filterDropdown');
      dropdown.value = '';
      filterData({ target: dropdown });
    }

    // Function to handle the click event of the "Download JSON" button
    function handleDownloadJSON() {
      if (selectedData) {
        const jsonData = JSON.stringify(selectedData, null, 2);
        const blob = new Blob([jsonData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${selectedData.Name}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    }

    // Function to create the OMJSON table
    function createOMTable(data) {
      const container = document.getElementById('resultContainer');
      container.innerHTML = '';

      const table = document.createElement('table');
      table.className = 'table';
      container.appendChild(table);

      const tbody = document.createElement('tbody');
      table.appendChild(tbody);

      const properties = Object.keys(data);

      properties.forEach(property => {
        const row = tbody.insertRow();

        const cell1 = row.insertCell();
        const cell2 = row.insertCell();

        cell1.textContent = property;
        cell2.textContent = data[property];
      });
    }

    // Function to create the ODJSON table
    function createODTable(data) {
      const container = document.getElementById('resultContainer');
      container.innerHTML = '';

      const table = document.createElement('table');
      table.className = 'table';
      container.appendChild(table);

      const tbody = document.createElement('tbody');
      table.appendChild(tbody);

      data.forEach(item => {
        const row = tbody.insertRow();

        const cell1 = row.insertCell();
        const cell2 = row.insertCell();

        cell1.textContent = item.Item;
        cell2.textContent = item.Value;
      });
    }

    // Function to adjust the font size of buttons and dropdowns based on the container width
    function adjustFontSize() {
      const containerWidth = document.getElementById('header').clientWidth;
      const buttons = document.querySelectorAll('button');
      const dropdowns = document.querySelectorAll('select');

      const maxFontSize = 24; // Set your desired maximum font size here
      const minFontSize = 12; // Set your desired minimum font size here

      buttons.forEach(button => {
        const fontSize = Math.min(maxFontSize, Math.max(minFontSize, containerWidth * 0.03));
        button.style.fontSize = fontSize + 'px';
      });

      dropdowns.forEach(dropdown => {
        const fontSize = Math.min(maxFontSize, Math.max(minFontSize, containerWidth * 0.015));
        dropdown.style.fontSize = fontSize + 'px';
      });
    }

    // Function to push the selected item to the history
    function pushHistory(item) {
      history.push(item);
      historyIndex = history.length - 1;
      forwardHistory = [];
    }

    // Initialization function
    async function initialize() {
      versionData = await fetchVersionData();
      populateVersionDropdown();

      const versionDropdown = document.getElementById('versionDropdown');
      versionDropdown.addEventListener('change', handleVersionChange);

      const filterDropdown = document.getElementById('filterDropdown');
      filterDropdown.addEventListener('change', filterData);

      const goBackButton = document.getElementById('goBackButton');
      goBackButton.addEventListener('click', handleGoBack);

      const goForwardButton = document.getElementById('goForwardButton');
      goForwardButton.addEventListener('click', handleGoForward);

      const mainMenuButton = document.getElementById('mainMenuButton');
      mainMenuButton.addEventListener('click', handleMainMenu);

      const downloadJSONButton = document.getElementById('downloadJSONButton');
      downloadJSONButton.addEventListener('click', handleDownloadJSON);

      window.addEventListener('resize', adjustFontSize);

      // Set initial version selection
      if (versionData.length > 0) {
        versionDropdown.value = versionData[0];
        versionDropdown.dispatchEvent(new Event('change'));
      }
    }

    // Call the initialization function
    initialize();
  </script>
</body>

</html>

